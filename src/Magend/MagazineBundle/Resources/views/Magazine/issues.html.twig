{% extends '::base.html.twig' %}

{% block contentTitle %}{{ magazine.name }}{% endblock %}

{% block main %}
    <div class="content-box"><!-- Start Content Box -->
        <div class="content-box-header">
            <h3>期刊列表</h3>
            <div>
                {#
                <select id="magtype_sel" class="span2 urlSelect" style="margin-top:8px;">     
                    <option value="">请选择杂志</option>      
                    {% for magazine in magazines %}      
                        <option value="{{ path('magazine_issues', { 'id':magazine.id }) }}" {% if magazine.id == app.request.get('id') %}selected="selected"{% endif %}>{{ magazine.name }}</option>
                    {% endfor %}
                </select>
                #}
                <a style="margin-top:6px;" class="btn btn-info" href="{{ path('issue_new', {'id':app.request.get('id')}) }}">添加期刊</a>
            </div>
            <div class="clear"></div>
        </div> <!-- End .content-box-header -->
                
        <div id="magissues" class="content-box-content">
            <div class="tab-content default-tab" id="tab1"> <!-- This is the target div. id must match the href of this div's tab -->
            <table>
                <thead><tr>
                    <th style="width:18px;"><input class="check-all" type="checkbox" /></th>
                    <th>标题</th>
                    <th>封面</th>
                    <th>创建日期</th>
                    <th>操作</th>
                </tr></thead>
                
                <tfoot><tr>
                    <td colspan="6">
                        <!--<div class="bulk-actions align-left">
                            <select name="dropdown" class="small">
                                <option value="option1">选择...</option>
                                <option value="option3">删除</option>
                            </select>
                            <a class="button" href="#">执行</a>
                        </div>-->
                        
                        {% if pager.haveToPaginate() %}{{ pagerfanta(pager, 'magend') }}{% endif %}
                        <div class="clear"></div>
                    </td>
                </tr></tfoot>
                
                <tbody>
                    {% for issue in issues %}
                    <tr>
                        <td><input type="checkbox" /></td>
                        <td><a href="{{ path('issue_article_list', { 'id':issue.id }) }}" title="查看编排文章">{{ issue.title|truncate(10) }}</a></td>
                        <td class="thumbup">
                            <!--<a class="media" title="竖版封面" href="{% if issue.portraitCover is not empty %}{{ asset('uploads/' ~ issue.portraitCover) }}{% else %}#{% endif %}" rel="facebox"><img width="30" height="40" src="{% if issue.portraitCover is not empty %}{{ asset('uploads/' ~ issue.portraitCover) }}{% endif %}" /></a>-->
                            <a class="media" title="横版封面" href="{% if issue.landscapeCover is not empty %}{{ asset('uploads/' ~ issue.landscapeCover) }}{% else %}#{% endif %}"><img width="40" height="30" src="{% if issue.landscapeCover is not empty %}{{ asset('uploads/' ~ issue.landscapeCover) }}{% endif %}" /></a>
                        </td>
                        <td style="width:100px;">{% if issue.createdAt %}{{ issue.createdAt|date('Y-m-d') }}{% endif%}</td>
                        <td style="width:120px;">
                            {% if not issue.isPublishedOfficially %}<a class="previewbtn" href="{{ path('issue_prepublish', { 'id':issue.id }) }}" title="预览"><img src="{{ asset('images/preview.png') }}" alt="预览" /></a>{% endif %}
                            {% if is_granted('ROLE_ADMIN') or (app.user.corp and not app.user.corp.trial) %}
                                {% if issue.isPublishedOfficially %}已发布{% else %}<a class="publishbtn" href="{{ path('issue_publish', { 'id':issue.id }) }}" title="发布"><img src="{{ asset('images/publish.png') }}" alt="发布" /></a>{% endif %}
                            {% endif %}
                            {% if not issue.isPublishedOfficially %}<a class="editbtn" href="{{ path('issue_edit', { 'id':issue.id }) }}" title="编辑"><img src="{{ asset('images/simpla/icons/pencil.png') }}" alt="编辑" /></a>{% endif %}
                            <a rel="confirm" href="{{ path('issue_flush', { 'id':issue.id }) }}" title="删除"><img src="{{ asset('images/simpla/icons/cross.png') }}" alt="删除" /></a>
                            {% if is_granted('ROLE_ADMIN') %}<a target="_blank" href="{{ path('output_issue', { 'id':issue.id }) }}" title="期刊内容XML">XML</a>{% endif %} 
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
    </div><!-- End Content Box -->
{% endblock %}